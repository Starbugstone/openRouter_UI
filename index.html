<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>OpenRouter Mini Playground</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="assets/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="assets/android-chrome-512x512.png">
  <link rel="manifest" href="assets/site.webmanifest">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div class="wrap">
    <h1>OpenRouter Mini Playground</h1>

    <div class="card">
      <div class="row">
        <div>
          <label>OpenRouter API Key</label>
          <div style="display: flex; gap: 8px; align-items: flex-start;">
            <input id="apiKey" type="password" placeholder="sk-or-v1-..." style="flex: 1;" />
            <button id="checkApiKeyBtn" class="btn secondary" style="padding: 10px 12px; white-space: nowrap;" title="Check API key status and credits">Check Status</button>
          </div>
          <div class="switch" style="margin-top:8px">
            <label class="pill"><input id="rememberKey" type="checkbox" /> Remember key (localStorage)</label>
          </div>
          <div id="apiKeyStatus" style="margin-top: 8px; display: none;">
            <!-- Status information will be displayed here -->
          </div>
        </div>
        <div>
          <label>Mode</label>
          <select id="mode">
            <option value="text">Text (Chat Completions)</option>
            <option value="image">Image Generation (via Chat + modalities)</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top:12px">
        <div style="flex: 1 1 300px;">
          <label>Model Selection</label>
          <div style="position: relative;">
            <button id="modelSelectorBtn" class="btn secondary" style="width: 100%; text-align: left; justify-content: space-between; display: flex; align-items: center;">
              <span id="selectedModelText">Select a model...</span>
              <span style="font-size: 12px;">â–¼</span>
            </button>
          </div>
          <div class="muted small" style="margin-top:6px">
            <strong>Free Models:</strong> <span id="modelCount">Loading...</span> available free models. 
            <button type="button" id="refreshModels" class="btn secondary" style="padding: 4px 8px; font-size: 11px; margin-left: 8px;">Refresh</button><br/>
            <strong>Note:</strong> Multiple images (n>1) may not be supported by all models. Google Gemini typically generates 1 image per request.
          </div>
        </div>
        <div id="imageOptions" style="display:none; flex: 0 0 auto; min-width: 120px;">
          <label>Number of images (best-effort)</label>
          <input id="imgCount" type="number" min="1" max="9" value="1" style="width: 3ch;" />
        </div>
      </div>

      <div class="actions" style="margin-top:12px">
        <button class="btn secondary" id="clearChatBtn">Clear Chat</button>
        <label class="pill"><input id="stream" type="checkbox" checked /> Stream</label>
        <label class="pill">Timeout (s): <input id="timeoutSec" type="number" min="5" max="120" value="30" style="width:64px;background:transparent;border:none;color:#e8eaed"/></label>
        <span class="muted small">If a stream hangs, use <em>Stop</em> or disable streaming.</span>
      </div>
    </div>

    <!-- Chat Interface -->
    <div class="card chat-container">
      <div class="chat-header">
        <label>Chat</label>
        <div class="chat-actions">
          <button class="btn secondary" id="stopBtn" style="display:none;">Stop</button>
        </div>
      </div>
      <div id="chatMessages" class="chat-messages"></div>
      <div class="chat-input-container">
        <div class="chat-input-wrapper">
          <div class="input-controls">
            <input type="file" id="imageUpload" accept="image/*" multiple style="display: none;">
            <button class="btn secondary" id="imageUploadBtn" title="Upload images">ðŸ“·</button>
            <textarea id="prompt" placeholder="Type your message here..." rows="1"></textarea>
          </div>
          <button class="btn" id="sendBtn">Send</button>
        </div>
        <div id="imagePreview" class="image-preview"></div>
      </div>
    </div>

    <!-- Modal for full-screen image viewing -->
    <div id="imageModal" class="modal">
      <span class="modal-close">&times;</span>
      <img class="modal-content" id="modalImage">
      <div id="modalCaption" class="modal-caption"></div>
    </div>

    <!-- Modal for model selection -->
    <div id="modelSelectorModal" class="modal">
      <div class="modal-content model-selector-content">
        <div class="modal-header">
          <h2>Select Model</h2>
          <span class="modal-close" id="modelModalClose">&times;</span>
        </div>
        <div class="modal-body">
          <div class="search-section">
            <input id="modelSearchPopup" type="text" placeholder="Search models by name, provider, or capabilities..." />
            <div class="filter-buttons">
              <button class="filter-btn active" data-filter="all">All</button>
              <button class="filter-btn" data-filter="text">Text</button>
              <button class="filter-btn" data-filter="image">Image</button>
              <button class="filter-btn" data-filter="multimodal">Multimodal</button>
            </div>
          </div>
          <div class="models-grid" id="modelsGrid">
            <!-- Models will be populated here -->
          </div>
        </div>
      </div>
    </div>

    <div class="muted small">
      Docs: <a href="https://openrouter.ai/docs/quickstart" target="_blank" rel="noopener">Quickstart</a> Â·
      <a href="https://openrouter.ai/docs/features/multimodal/image-generation" target="_blank" rel="noopener">Image Gen via chat</a> Â·
      <a href="https://openrouter.ai/models" target="_blank" rel="noopener">Models</a>
    </div>
  </div>

  <!-- Load modules in dependency order -->
  <script src="js/dom-utils.js"></script>
  <script src="js/api-service.js"></script>
  <script src="js/model-manager.js"></script>
  <script src="js/chat-manager.js"></script>
  <script src="js/image-handler.js"></script>
  <script src="js/regeneration-manager.js"></script>
  <script src="js/modal-manager.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
